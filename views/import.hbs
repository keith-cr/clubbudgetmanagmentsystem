<h1>Import Budget</h1>
<input type="file" name="xlfile" id="xlf">
<script lang="javascript" src="js/xlsx.full.min.js"></script>
<script>
function handleFile(e) {
  var files = e.target.files, f = files[0];
  var reader = new FileReader();
  reader.onload = function(e) {
    var data = new Uint8Array(e.target.result);
    var workbook = XLSX.read(data, {type: 'array'});

    console.log(workbook);
    var first_sheet_name = workbook.SheetNames[0];
    var address_of_cell = 'A3';
    var worksheet = workbook.Sheets[first_sheet_name];
    var desired_cell = worksheet[address_of_cell];
    var fiscalyear = (desired_cell ? desired_cell.v : undefined);

    const regex = /\d+/;
    const year = fiscalyear.match(regex)[0];

    let params="year="+year+"&clubid="+1;
    var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP");
    xhr.open('POST', '/import');
    xhr.onreadystatechange = function() {
        if (xhr.readyState>3 && xhr.status==200) { console.log(xhr.responseText) }
    };
    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.send(params);
  };
  reader.readAsArrayBuffer(f);
}
var input_dom_element = document.getElementById('xlf');
input_dom_element.addEventListener('change', handleFile, false);
</script>
